name: Build InvokeAI

on:
  # push:
  # delete:
  create:

jobs:
  Build-InvokeAI:
    name: Build InvokeAI
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Enter Workspace
        shell: pwsh
        run: |
          Set-Location -Path "${{ github.workspace }}"

      - name: List files in the repository
        shell: pwsh
        run: |
          Get-ChildItem -Path "${{ github.workspace }}" -Recurse

      - name: Launch InvokeAI Installer
        shell: pwsh
        run: |
          & "${{ github.workspace }}/invokeai_installer.ps1" `
            -InstallPath "${{ github.workspace }}/invokeai" `
            -BuildMode `
            -BuildWithUpdate `
            -BuildWithUpdateNode `
            -BuildWithLaunch `
            -BuildWithTorchReinstall `
            -BuildWitchBranch 3 `
            -DisablePipMirror `
            -DisableGithubMirror `
            -DisableHuggingFaceMirror `
            -InstallLatest

      # - name: Archive
      #   shell: pwsh
      #   run: |
      #     7z a -t7z "${{ github.workspace }}/artifact/sd_webui_forge_nightly_cu126.7z" "${{ github.workspace }}/sd_webui_forge"

      # - name: Artifact
      #   uses: actions/upload-artifact@v4
      #   with:
      #     name: sd_webui_forge_nightly
      #     path: ${{ github.workspace }}/artifact/

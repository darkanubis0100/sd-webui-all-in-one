<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>整合包下载列表</title>
    <link rel="stylesheet" href="style.css">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="container">
        <h1>整合包下载列表</h1>
        <div class="announcement">
            <h3>基于 <a href="https://github.com/licyk/sd-webui-all-in-one?tab=readme-ov-file#installer">sd-webui-all-in-one/Installer</a> 全自动构建整合包</h3>
            <p>项目地址：<a href="https://github.com/licyk/sd-webui-all-in-one" target="_blank">https://github.com/licyk/sd-webui-all-in-one</a></p>
            <p>原仓库：HuggingFace / ModelScope</p>
            <p>Stable 列表为稳定版本, Nightly 为测试版本, 根据需求自行下载</p>
            <p>若整合包无法解压，请下载并安装 7-Zip 后再尝试解压</p>
            <p>整合包说明与反馈可前往：<a href="https://github.com/licyk/sd-webui-all-in-one/discussions/1" target="_blank">AI 绘画 / 训练整合包 · licyk/sd-webui-all-in-one · Discussion #1</a></p>
            <p class="update-time">列表更新时间：<span id="update-time"></span></p>
        </div>
        <div id="download-list">
            <div class="loading">
                <div class="spinner"></div>
                <p>正在加载数据...</p>
            </div>
        </div>
    </div>
    <footer class="footer">
        <p>Copyright © 2025 <a href="https://github.com/licyk">licyk</a></p>
    </footer>

    <script>
        fetch('portable_list.json')
            .then(response => response.json())
            .then(data => {
                // 显示更新时间
                document.getElementById('update-time').textContent = data.update_time;
                
                const container = document.getElementById('download-list');
                container.innerHTML = '';
                
                // 处理stable版本
                const stableDiv = document.createElement('div');
                stableDiv.className = 'version-section';
                stableDiv.innerHTML = '<h2>Stable 版本</h2>';
                container.appendChild(stableDiv);
                
                for (const [software, items] of Object.entries(data.stable)) {
                    const softwareDiv = document.createElement('div');
                    softwareDiv.className = 'software-section';
                    const itemsList = document.createElement('ul');
                    itemsList.className = 'download-items';
                    
                    // 创建标题
                    softwareDiv.innerHTML = `<h3>${software}</h3>`;
                    softwareDiv.appendChild(itemsList);
                    
                    // 添加下载项(默认只显示前3个)
                    items.forEach((item, index) => {
                        const li = document.createElement('li');
                        if (index === 0) {
                            li.innerHTML = `<a href="${item[1]}" download>${item[0]} <span class="latest-tag">(最新版)</span></a>`;
                            li.classList.add('latest-item');
                        } else {
                            li.innerHTML = `<a href="${item[1]}" download>${item[0]}</a>`;
                        }
                        if (index >= 3) {
                            li.classList.add('hidden-item');
                        }
                        itemsList.appendChild(li);
                    });
                    
                    // 如果超过3个，添加展开按钮
                    if (items.length > 3) {
                        const toggleBtn = document.createElement('button');
                        toggleBtn.className = 'toggle-btn';
                        toggleBtn.innerHTML = '展开更多 ▼';
                        toggleBtn.addEventListener('click', function() {
                            const hiddenItems = itemsList.querySelectorAll('li:nth-child(n+4)');
                            const firstHidden = hiddenItems[0];
                            const isHidden = firstHidden.style.display === 'none' || 
                                           firstHidden.classList.contains('hidden-item');
                            
                            if (isHidden) {
                                // 展开
                                hiddenItems.forEach(item => {
                                    item.style.display = 'block';
                                    item.classList.remove('hidden-item');
                                });
                                toggleBtn.innerHTML = '收起 ▲';
                            } else {
                                // 收起
                                hiddenItems.forEach(item => {
                                    item.style.display = 'none';
                                    item.classList.add('hidden-item');
                                });
                                toggleBtn.innerHTML = '展开更多 ▼';
                            }
                        });
                        
                        softwareDiv.appendChild(toggleBtn);
                    }
                    
                    stableDiv.appendChild(softwareDiv);
                }
                
                // 处理nightly版本(同上)
                const nightlyDiv = document.createElement('div');
                nightlyDiv.className = 'version-section';
                nightlyDiv.innerHTML = '<h2>Nightly 版本</h2>';
                container.appendChild(nightlyDiv);
                
                for (const [software, items] of Object.entries(data.nightly)) {
                    const softwareDiv = document.createElement('div');
                    softwareDiv.className = 'software-section';
                    const itemsList = document.createElement('ul');
                    itemsList.className = 'download-items';
                    
                    softwareDiv.innerHTML = `<h3>${software}</h3>`;
                    softwareDiv.appendChild(itemsList);
                    
                    items.forEach((item, index) => {
                        const li = document.createElement('li');
                        if (index === 0) {
                            li.innerHTML = `<a href="${item[1]}" download>${item[0]} <span class="latest-tag">(最新版)</span></a>`;
                            li.classList.add('latest-item');
                        } else {
                            li.innerHTML = `<a href="${item[1]}" download>${item[0]}</a>`;
                        }
                        if (index >= 3) {
                            li.classList.add('hidden-item');
                        }
                        itemsList.appendChild(li);
                    });
                    
                    if (items.length > 3) {
                        const toggleBtn = document.createElement('button');
                        toggleBtn.className = 'toggle-btn';
                        toggleBtn.innerHTML = '展开更多 ▼';
                        toggleBtn.addEventListener('click', function() {
                            const hiddenItems = itemsList.querySelectorAll('li:nth-child(n+4)');
                            const firstHidden = hiddenItems[0];
                            const isHidden = firstHidden.style.display === 'none' || 
                                           firstHidden.classList.contains('hidden-item');
                            
                            if (isHidden) {
                                // 展开
                                hiddenItems.forEach(item => {
                                    item.style.display = 'block';
                                    item.classList.remove('hidden-item');
                                });
                                toggleBtn.innerHTML = '收起 ▲';
                            } else {
                                // 收起
                                hiddenItems.forEach(item => {
                                    item.style.display = 'none';
                                    item.classList.add('hidden-item');
                                });
                                toggleBtn.innerHTML = '展开更多 ▼';
                            }
                        });
                        
                        softwareDiv.appendChild(toggleBtn);
                    }
                    
                    nightlyDiv.appendChild(softwareDiv);
                }
            })
            .catch(error => {
                console.error('加载数据失败:', error);
                document.getElementById('download-list').innerHTML = '<p class="error">加载数据失败，请刷新页面重试。</p>';
            });
    </script>
</body>
</html>
